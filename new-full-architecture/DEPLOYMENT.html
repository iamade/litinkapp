<!DOCTYPE html>
<html>
<head>
<title>DEPLOYMENT.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="deployment--infrastructure---litinkai-platform">Deployment &amp; Infrastructure - LitinkAI Platform</h1>
<p>Complete deployment architecture, infrastructure diagrams, and operational procedures for the LitinkAI platform.</p>
<hr>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#infrastructure-overview">Infrastructure Overview</a></li>
<li><a href="#deployment-architecture">Deployment Architecture</a></li>
<li><a href="#container-architecture">Container Architecture</a></li>
<li><a href="#environment-configuration">Environment Configuration</a></li>
<li><a href="#cicd-pipeline">CI/CD Pipeline</a></li>
<li><a href="#scaling-strategy">Scaling Strategy</a></li>
<li><a href="#monitoring--observability">Monitoring &amp; Observability</a></li>
<li><a href="#disaster-recovery">Disaster Recovery</a></li>
<li><a href="#security-configuration">Security Configuration</a></li>
<li><a href="#cost-optimization">Cost Optimization</a></li>
</ol>
<hr>
<h2 id="infrastructure-overview">Infrastructure Overview</h2>
<h3 id="technology-stack">Technology Stack</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Client Layer"
        Browser[Web Browser]
        Mobile[Mobile App<br/>Future]
    end
    
    subgraph "CDN & Edge"
        Netlify[Netlify CDN<br/>Frontend Hosting]
        Cloudflare[Cloudflare<br/>DNS & DDoS]
    end
    
    subgraph "Application Layer"
        LB[Load Balancer<br/>Traefik]
        API1[API Container 1]
        API2[API Container 2]
        API3[API Container N]
    end
    
    subgraph "Worker Layer"
        Worker1[Celery Worker 1<br/>Image Tasks]
        Worker2[Celery Worker 2<br/>Video Tasks]
        Worker3[Celery Worker 3<br/>Audio Tasks]
        Worker4[Celery Worker N<br/>General Tasks]
        Flower[Flower<br/>Monitoring]
    end
    
    subgraph "Cache & Queue"
        Redis[(Redis<br/>Cache & Queue)]
    end
    
    subgraph "Database Layer"
        Supabase[(Supabase<br/>PostgreSQL)]
        Storage[Supabase<br/>Object Storage]
    end
    
    subgraph "External Services"
        OpenRouter[OpenRouter<br/>LLM Gateway]
        ModelsLab[ModelsLab<br/>Image/Video]
        ElevenLabs[ElevenLabs<br/>Audio]
        Stripe[Stripe<br/>Payments]
        Mailgun[Mailgun<br/>Email]
    end
    
    Browser --> Cloudflare
    Cloudflare --> Netlify
    Browser --> Cloudflare
    Cloudflare --> LB
    
    LB --> API1
    LB --> API2
    LB --> API3
    
    API1 --> Redis
    API2 --> Redis
    API3 --> Redis
    
    API1 --> Supabase
    API2 --> Supabase
    API3 --> Supabase
    
    Redis --> Worker1
    Redis --> Worker2
    Redis --> Worker3
    Redis --> Worker4
    
    Worker1 --> Storage
    Worker2 --> Storage
    Worker3 --> Storage
    
    API1 -.-> OpenRouter
    API2 -.-> ModelsLab
    API3 -.-> ElevenLabs
    API1 -.-> Stripe
    API2 -.-> Mailgun
    
    Worker1 -.-> ModelsLab
    Worker2 -.-> ModelsLab
    Worker3 -.-> ElevenLabs
</div></code></pre>
<h3 id="infrastructure-components">Infrastructure Components</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
<th>Scaling</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Frontend</strong></td>
<td>React + Vite</td>
<td>User interface</td>
<td>CDN distribution</td>
</tr>
<tr>
<td><strong>API Gateway</strong></td>
<td>FastAPI + Uvicorn</td>
<td>REST API endpoints</td>
<td>Horizontal (3-10 instances)</td>
</tr>
<tr>
<td><strong>Load Balancer</strong></td>
<td>Traefik</td>
<td>Request distribution</td>
<td>High availability pair</td>
</tr>
<tr>
<td><strong>Workers</strong></td>
<td>Celery + Python</td>
<td>Async task processing</td>
<td>Horizontal (5-50 workers)</td>
</tr>
<tr>
<td><strong>Cache/Queue</strong></td>
<td>Redis</td>
<td>Caching &amp; messaging</td>
<td>Master-replica with Sentinel</td>
</tr>
<tr>
<td><strong>Database</strong></td>
<td>PostgreSQL (Supabase)</td>
<td>Primary data store</td>
<td>Managed service</td>
</tr>
<tr>
<td><strong>Object Storage</strong></td>
<td>Supabase Storage</td>
<td>Media files</td>
<td>Managed service</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Flower + Sentry</td>
<td>Task &amp; error tracking</td>
<td>Single instance</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="deployment-architecture">Deployment Architecture</h2>
<h3 id="production-environment-diagram">Production Environment Diagram</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Internet"
        Users[Users]
    end
    
    subgraph "Edge Layer - Cloudflare"
        DNS[DNS]
        CDN[CDN Cache]
        WAF[Web Application Firewall]
        DDoS[DDoS Protection]
    end
    
    subgraph "Frontend - Netlify"
        Static[Static Assets<br/>React Build]
    end
    
    subgraph "VPS/Cloud Server - DigitalOcean/AWS"
        subgraph "Docker Network"
            Traefik[Traefik<br/>:80, :443]
            
            subgraph "API Services"
                API_1[API Instance 1<br/>:8001]
                API_2[API Instance 2<br/>:8002]
                API_3[API Instance 3<br/>:8003]
            end
            
            subgraph "Worker Services"
                Worker_Image[Image Worker<br/>x3 instances]
                Worker_Video[Video Worker<br/>x3 instances]
                Worker_Audio[Audio Worker<br/>x2 instances]
                Worker_General[General Worker<br/>x2 instances]
            end
            
            Redis_Master[Redis Master<br/>:6379]
            Redis_Replica[Redis Replica<br/>:6380]
            
            Flower[Flower Dashboard<br/>:5555]
            Mailpit[Mailpit<br/>Dev Email<br/>:8025]
        end
    end
    
    subgraph "Managed Services"
        Supabase_DB[(Supabase PostgreSQL)]
        Supabase_Auth[Supabase Auth]
        Supabase_Storage[Supabase Storage]
        
        Stripe_API[Stripe API]
        Mailgun_API[Mailgun API]
        
        OpenRouter_API[OpenRouter API]
        ModelsLab_API[ModelsLab API]
        ElevenLabs_API[ElevenLabs API]
    end
    
    Users --> DNS
    DNS --> WAF
    WAF --> DDoS
    DDoS --> CDN
    
    CDN --> Static
    CDN --> Traefik
    
    Traefik --> API_1
    Traefik --> API_2
    Traefik --> API_3
    Traefik --> Flower
    
    API_1 --> Redis_Master
    API_2 --> Redis_Master
    API_3 --> Redis_Master
    
    Redis_Master -.->|Replication| Redis_Replica
    
    Redis_Master --> Worker_Image
    Redis_Master --> Worker_Video
    Redis_Master --> Worker_Audio
    Redis_Master --> Worker_General
    
    API_1 --> Supabase_DB
    API_1 --> Supabase_Auth
    Worker_Image --> Supabase_Storage
    Worker_Video --> Supabase_Storage
    Worker_Audio --> Supabase_Storage
    
    API_1 -.->|HTTPS| Stripe_API
    API_2 -.->|HTTPS| Mailgun_API
    API_1 -.->|HTTPS| OpenRouter_API
    Worker_Image -.->|HTTPS| ModelsLab_API
    Worker_Audio -.->|HTTPS| ElevenLabs_API
</div></code></pre>
<h3 id="environment-tiers">Environment Tiers</h3>
<h4 id="development">Development</h4>
<ul>
<li>Local Docker Compose</li>
<li>Single instance of each service</li>
<li>SQLite or local PostgreSQL</li>
<li>Mock external services</li>
<li>Hot reload enabled</li>
</ul>
<h4 id="staging">Staging</h4>
<ul>
<li>Mimics production setup</li>
<li>Smaller instance sizes</li>
<li>Test data only</li>
<li>Full external service integration</li>
<li>Automated testing</li>
</ul>
<h4 id="production">Production</h4>
<ul>
<li>Multi-instance deployment</li>
<li>High availability configuration</li>
<li>Production databases</li>
<li>CDN enabled</li>
<li>Full monitoring</li>
</ul>
<hr>
<h2 id="container-architecture">Container Architecture</h2>
<h3 id="docker-compose-structure">Docker Compose Structure</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># docker-compose.yml</span>
<span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># API Gateway (3 replicas)</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">litinkai/api:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
      <span class="hljs-attr">resources:</span>
        <span class="hljs-attr">limits:</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'2'</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">4G</span>
        <span class="hljs-attr">reservations:</span>
          <span class="hljs-attr">cpus:</span> <span class="hljs-string">'1'</span>
          <span class="hljs-attr">memory:</span> <span class="hljs-string">2G</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ENVIRONMENT=production</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DATABASE_URL=${DATABASE_URL}</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">REDIS_URL=redis://redis:6379</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">OPENROUTER_API_KEY=${OPENROUTER_API_KEY}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> <span class="hljs-string">["CMD",</span> <span class="hljs-string">"curl"</span><span class="hljs-string">,</span> <span class="hljs-string">"-f"</span><span class="hljs-string">,</span> <span class="hljs-string">"http://localhost:8000/health"</span><span class="hljs-string">]</span>
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">10s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span>

  <span class="hljs-comment"># Celery Workers - Image Generation</span>
  <span class="hljs-attr">worker-image:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">litinkai/worker:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">celery</span> <span class="hljs-string">-A</span> <span class="hljs-string">app.celery_app</span> <span class="hljs-string">worker</span> <span class="hljs-string">-Q</span> <span class="hljs-string">image</span> <span class="hljs-string">-c</span> <span class="hljs-number">4</span> <span class="hljs-string">-n</span> <span class="hljs-string">image@%h</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">WORKER_TYPE=image</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MODELSLAB_API_KEY=${MODELSLAB_API_KEY}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-comment"># Celery Workers - Video Generation</span>
  <span class="hljs-attr">worker-video:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">litinkai/worker:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">3</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">celery</span> <span class="hljs-string">-A</span> <span class="hljs-string">app.celery_app</span> <span class="hljs-string">worker</span> <span class="hljs-string">-Q</span> <span class="hljs-string">video</span> <span class="hljs-string">-c</span> <span class="hljs-number">2</span> <span class="hljs-string">-n</span> <span class="hljs-string">video@%h</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">WORKER_TYPE=video</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-comment"># Celery Workers - Audio Generation</span>
  <span class="hljs-attr">worker-audio:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">litinkai/worker:latest</span>
    <span class="hljs-attr">deploy:</span>
      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">celery</span> <span class="hljs-string">-A</span> <span class="hljs-string">app.celery_app</span> <span class="hljs-string">worker</span> <span class="hljs-string">-Q</span> <span class="hljs-string">audio</span> <span class="hljs-string">-c</span> <span class="hljs-number">4</span> <span class="hljs-string">-n</span> <span class="hljs-string">audio@%h</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">WORKER_TYPE=audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">ELEVENLABS_API_KEY=${ELEVENLABS_API_KEY}</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-comment"># Redis (with persistence)</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">--appendonly</span> <span class="hljs-literal">yes</span> <span class="hljs-string">--maxmemory</span> <span class="hljs-string">4gb</span> <span class="hljs-string">--maxmemory-policy</span> <span class="hljs-string">allkeys-lru</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-data:/data</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> <span class="hljs-string">["CMD",</span> <span class="hljs-string">"redis-cli"</span><span class="hljs-string">,</span> <span class="hljs-string">"ping"</span><span class="hljs-string">]</span>
      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span>

  <span class="hljs-comment"># Flower (monitoring)</span>
  <span class="hljs-attr">flower:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mher/flower:latest</span>
    <span class="hljs-attr">command:</span> <span class="hljs-string">celery</span> <span class="hljs-string">flower</span> <span class="hljs-string">--broker=redis://redis:6379</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CELERY_BROKER_URL=redis://redis:6379</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"5555:5555"</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

  <span class="hljs-comment"># Traefik (load balancer)</span>
  <span class="hljs-attr">traefik:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">traefik:v2.10</span>
    <span class="hljs-attr">command:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--api.insecure=false"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--providers.docker=true"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--entrypoints.web.address=:80"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--entrypoints.websecure.address=:443"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"--certificatesresolvers.letsencrypt.acme.httpchallenge=true"</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"80:80"</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"443:443"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./traefik/acme.json:/acme.json</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">redis-data:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">backend:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</div></code></pre>
<h3 id="container-images">Container Images</h3>
<h4 id="api-image-dockerfile">API Image (Dockerfile)</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># backend/Dockerfile</span>
<span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.11</span>-slim as base

<span class="hljs-comment"># Set environment variables</span>
<span class="hljs-keyword">ENV</span> PYTHONUNBUFFERED=<span class="hljs-number">1</span> \
    PYTHONDONTWRITEBYTECODE=<span class="hljs-number">1</span> \
    PIP_NO_CACHE_DIR=<span class="hljs-number">1</span> \
    PIP_DISABLE_PIP_VERSION_CHECK=<span class="hljs-number">1</span>

<span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span>

<span class="hljs-comment"># Install system dependencies</span>
<span class="hljs-keyword">RUN</span><span class="bash"> apt-get update &amp;&amp; apt-get install -y \
    curl \
    ffmpeg \
    &amp;&amp; rm -rf /var/lib/apt/lists/*</span>

<span class="hljs-comment"># Copy requirements</span>
<span class="hljs-keyword">COPY</span><span class="bash"> requirements.txt .</span>
<span class="hljs-keyword">RUN</span><span class="bash"> pip install --no-cache-dir -r requirements.txt</span>

<span class="hljs-comment"># Copy application code</span>
<span class="hljs-keyword">COPY</span><span class="bash"> . .</span>

<span class="hljs-comment"># Health check</span>
<span class="hljs-keyword">HEALTHCHECK</span><span class="bash"> --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD curl -f http://localhost:8000/health || <span class="hljs-built_in">exit</span> 1</span>

<span class="hljs-comment"># Run application</span>
<span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">"uvicorn"</span>, <span class="hljs-string">"app.main:app"</span>, <span class="hljs-string">"--host"</span>, <span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-string">"--port"</span>, <span class="hljs-string">"8000"</span>, <span class="hljs-string">"--workers"</span>, <span class="hljs-string">"4"</span>]</span>
</div></code></pre>
<h4 id="frontend-build-netlify">Frontend Build (Netlify)</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># netlify.toml</span>
<span class="hljs-section">[build]</span>
  command = "npm run build"
  publish = "dist"
  
<span class="hljs-section">[build.environment]</span>
  NODE_VERSION = "18"
  
<span class="hljs-section">[[redirects]]</span>
  from = "/api/*"
  to = "https://api.litinkai.com/api/:splat"
  status = 200
  
<span class="hljs-section">[[redirects]]</span>
  from = "/*"
  to = "/index.html"
  status = 200
  
<span class="hljs-section">[[headers]]</span>
  for = "/*"
  <span class="hljs-section">[headers.values]</span>
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1<span class="hljs-comment">; mode=block"</span>
    Referrer-Policy = "strict-origin-when-cross-origin"
</div></code></pre>
<hr>
<h2 id="environment-configuration">Environment Configuration</h2>
<h3 id="environment-variables">Environment Variables</h3>
<h4 id="api-service-envproduction">API Service (.env.production)</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Application</span>
ENVIRONMENT=production
APP_NAME=LitinkAI
API_VERSION=v1
DEBUG=<span class="hljs-literal">false</span>
LOG_LEVEL=INFO

<span class="hljs-comment"># Database</span>
DATABASE_URL=postgresql://user:pass@host:5432/litinkai
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_ANON_KEY=xxxxx
SUPABASE_SERVICE_KEY=xxxxx

<span class="hljs-comment"># Redis</span>
REDIS_URL=redis://redis:6379/0
REDIS_MAX_CONNECTIONS=50

<span class="hljs-comment"># Celery</span>
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1

<span class="hljs-comment"># AI Services</span>
OPENROUTER_API_KEY=sk-or-xxxxx
OPENAI_API_KEY=sk-xxxxx
DEEPSEEK_API_KEY=xxxxx
MODELSLAB_API_KEY=xxxxx
ELEVENLABS_API_KEY=xxxxx

<span class="hljs-comment"># Payment</span>
STRIPE_SECRET_KEY=sk_live_xxxxx
STRIPE_WEBHOOK_SECRET=whsec_xxxxx
STRIPE_PUBLISHABLE_KEY=pk_live_xxxxx

<span class="hljs-comment"># Email</span>
MAILGUN_API_KEY=xxxxx
MAILGUN_DOMAIN=mg.litinkai.com
EMAIL_FROM=noreply@litinkai.com

<span class="hljs-comment"># Security</span>
JWT_SECRET_KEY=xxxxx-random-secret-xxxxx
JWT_ALGORITHM=HS256
JWT_EXPIRATION_MINUTES=60
REFRESH_TOKEN_EXPIRE_DAYS=30

<span class="hljs-comment"># CORS</span>
ALLOWED_ORIGINS=https://litinkai.com,https://www.litinkai.com
CORS_ALLOW_CREDENTIALS=<span class="hljs-literal">true</span>

<span class="hljs-comment"># Rate Limiting</span>
RATE_LIMIT_ENABLED=<span class="hljs-literal">true</span>
RATE_LIMIT_PER_MINUTE=60

<span class="hljs-comment"># Monitoring</span>
SENTRY_DSN=https://xxxxx@sentry.io/xxxxx
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
</div></code></pre>
<h4 id="frontend-envproduction">Frontend (.env.production)</h4>
<pre class="hljs"><code><div>VITE_API_BASE_URL=https://api.litinkai.com/api/v1
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=xxxxx
VITE_STRIPE_PUBLISHABLE_KEY=pk_live_xxxxx
VITE_ENVIRONMENT=production
</div></code></pre>
<hr>
<h2 id="cicd-pipeline">CI/CD Pipeline</h2>
<h3 id="github-actions-workflow">GitHub Actions Workflow</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># .github/workflows/deploy.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Production</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> <span class="hljs-string">[main]</span>
  <span class="hljs-attr">workflow_dispatch:</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Python</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-python@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">python-version:</span> <span class="hljs-string">'3.11'</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          cd backend
          pip install -r requirements.txt
          pip install pytest pytest-asyncio
</span>      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          cd backend
          pytest tests/ -v
</span>      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Lint</span> <span class="hljs-string">code</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          cd backend
          flake8 app/ --max-line-length=100
</span>
  <span class="hljs-attr">build-backend:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Buildx</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/setup-buildx-action@v2</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Login</span> <span class="hljs-string">to</span> <span class="hljs-string">Docker</span> <span class="hljs-string">Hub</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/login-action@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.DOCKER_USERNAME</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">password:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.DOCKER_PASSWORD</span> <span class="hljs-string">}}</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">API</span> <span class="hljs-string">image</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/build-push-action@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">context:</span> <span class="hljs-string">./backend</span>
          <span class="hljs-attr">push:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">tags:</span> <span class="hljs-string">litinkai/api:latest,litinkai/api:${{</span> <span class="hljs-string">github.sha</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">cache-from:</span> <span class="hljs-string">type=registry,ref=litinkai/api:latest</span>
          <span class="hljs-attr">cache-to:</span> <span class="hljs-string">type=inline</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span> <span class="hljs-string">Worker</span> <span class="hljs-string">image</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/build-push-action@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">context:</span> <span class="hljs-string">./backend</span>
          <span class="hljs-attr">file:</span> <span class="hljs-string">./backend/Dockerfile.worker</span>
          <span class="hljs-attr">push:</span> <span class="hljs-literal">true</span>
          <span class="hljs-attr">tags:</span> <span class="hljs-string">litinkai/worker:latest,litinkai/worker:${{</span> <span class="hljs-string">github.sha</span> <span class="hljs-string">}}</span>

  <span class="hljs-attr">build-frontend:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Node.js</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-string">'18'</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">VITE_API_BASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.VITE_API_BASE_URL</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">VITE_SUPABASE_URL:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.VITE_SUPABASE_URL</span> <span class="hljs-string">}}</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">Netlify</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">netlify/actions/cli@master</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">args:</span> <span class="hljs-string">deploy</span> <span class="hljs-string">--prod</span> <span class="hljs-string">--dir=dist</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">NETLIFY_SITE_ID:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NETLIFY_SITE_ID</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">NETLIFY_AUTH_TOKEN:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.NETLIFY_AUTH_TOKEN</span> <span class="hljs-string">}}</span>

  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">[build-backend,</span> <span class="hljs-string">build-frontend]</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">production</span> <span class="hljs-string">server</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">appleboy/ssh-action@master</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">host:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.PROD_SERVER_HOST</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">username:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.PROD_SERVER_USER</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">key:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.PROD_SERVER_SSH_KEY</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">script:</span> <span class="hljs-string">|
            cd /opt/litinkai
            docker-compose pull
            docker-compose up -d --remove-orphans
            docker image prune -f
</span>      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Health</span> <span class="hljs-string">check</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">|
          sleep 30
          curl -f https://api.litinkai.com/health || exit 1
</span>      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Notify</span> <span class="hljs-string">deployment</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">8398a7/action-slack@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">status:</span> <span class="hljs-string">${{</span> <span class="hljs-string">job.status</span> <span class="hljs-string">}}</span>
          <span class="hljs-attr">text:</span> <span class="hljs-string">'Deployment to production completed!'</span>
          <span class="hljs-attr">webhook_url:</span> <span class="hljs-string">${{</span> <span class="hljs-string">secrets.SLACK_WEBHOOK</span> <span class="hljs-string">}}</span>
</div></code></pre>
<h3 id="deployment-process">Deployment Process</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph LR
    A[Code Push] --> B[Run Tests]
    B --> C{Tests Pass?}
    C -->|No| D[Notify Failure]
    C -->|Yes| E[Build Docker Images]
    E --> F[Push to Registry]
    F --> G[Deploy to Staging]
    G --> H[Run Integration Tests]
    H --> I{Tests Pass?}
    I -->|No| J[Rollback]
    I -->|Yes| K[Deploy to Production]
    K --> L[Health Checks]
    L --> M{Healthy?}
    M -->|No| N[Rollback]
    M -->|Yes| O[Notify Success]
</div></code></pre>
<hr>
<h2 id="scaling-strategy">Scaling Strategy</h2>
<h3 id="horizontal-scaling">Horizontal Scaling</h3>
<h4 id="api-instances">API Instances</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Scale API to 5 instances</span>
docker-compose up --scale api=5 -d

<span class="hljs-comment"># Auto-scaling rules (Kubernetes HPA)</span>
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - <span class="hljs-built_in">type</span>: Resource
    resource:
      name: cpu
      target:
        <span class="hljs-built_in">type</span>: Utilization
        averageUtilization: 70
  - <span class="hljs-built_in">type</span>: Resource
    resource:
      name: memory
      target:
        <span class="hljs-built_in">type</span>: Utilization
        averageUtilization: 80
</div></code></pre>
<h4 id="worker-scaling-strategy">Worker Scaling Strategy</h4>
<table>
<thead>
<tr>
<th>Worker Type</th>
<th>Min</th>
<th>Max</th>
<th>Scale Trigger</th>
</tr>
</thead>
<tbody>
<tr>
<td>Image</td>
<td>3</td>
<td>10</td>
<td>Queue depth &gt; 50</td>
</tr>
<tr>
<td>Video</td>
<td>3</td>
<td>8</td>
<td>Queue depth &gt; 30</td>
</tr>
<tr>
<td>Audio</td>
<td>2</td>
<td>6</td>
<td>Queue depth &gt; 40</td>
</tr>
<tr>
<td>General</td>
<td>2</td>
<td>5</td>
<td>Queue depth &gt; 100</td>
</tr>
</tbody>
</table>
<h3 id="vertical-scaling">Vertical Scaling</h3>
<h4 id="resource-allocation">Resource Allocation</h4>
<p><strong>API Containers:</strong></p>
<ul>
<li>CPU: 1-2 cores per instance</li>
<li>Memory: 2-4GB per instance</li>
<li>Storage: 10GB per instance</li>
</ul>
<p><strong>Worker Containers:</strong></p>
<ul>
<li>Image Workers: 2-4 cores, 4-8GB RAM</li>
<li>Video Workers: 4-8 cores, 8-16GB RAM</li>
<li>Audio Workers: 2 cores, 2-4GB RAM</li>
</ul>
<p><strong>Redis:</strong></p>
<ul>
<li>Memory: 4-8GB (based on queue size)</li>
<li>CPU: 2 cores</li>
</ul>
<hr>
<h2 id="monitoring--observability">Monitoring &amp; Observability</h2>
<h3 id="monitoring-stack">Monitoring Stack</h3>
<pre><code class="language-mermaid"><div class="mermaid">graph TB
    subgraph "Application Layer"
        API[API Instances]
        Workers[Celery Workers]
    end
    
    subgraph "Metrics Collection"
        Prometheus[Prometheus]
        StatsD[StatsD]
    end
    
    subgraph "Visualization"
        Grafana[Grafana Dashboards]
        Flower[Flower UI]
    end
    
    subgraph "Logging"
        Loki[Loki]
        CloudWatch[AWS CloudWatch]
    end
    
    subgraph "Alerting"
        AlertManager[Alert Manager]
        PagerDuty[PagerDuty]
        Slack[Slack]
    end
    
    subgraph "Error Tracking"
        Sentry[Sentry]
    end
    
    API --> Prometheus
    Workers --> Prometheus
    API --> StatsD
    Workers --> StatsD
    
    Prometheus --> Grafana
    Workers --> Flower
    
    API --> Loki
    Workers --> Loki
    API --> CloudWatch
    
    Prometheus --> AlertManager
    AlertManager --> PagerDuty
    AlertManager --> Slack
    
    API --> Sentry
    Workers --> Sentry
</div></code></pre>
<h3 id="key-metrics">Key Metrics</h3>
<h4 id="application-metrics">Application Metrics</h4>
<ul>
<li>Request rate (requests/second)</li>
<li>Response time (p50, p95, p99)</li>
<li>Error rate (errors/second)</li>
<li>Active connections</li>
<li>CPU and memory usage</li>
</ul>
<h4 id="business-metrics">Business Metrics</h4>
<ul>
<li>User registrations (per day)</li>
<li>Subscription conversions</li>
<li>Video generations (per hour)</li>
<li>AI API costs (per day)</li>
<li>Storage usage (GB)</li>
</ul>
<h4 id="worker-metrics">Worker Metrics</h4>
<ul>
<li>Queue depth per queue</li>
<li>Task success/failure rate</li>
<li>Average task duration</li>
<li>Worker utilization</li>
<li>Retry counts</li>
</ul>
<h3 id="alerting-rules">Alerting Rules</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># alerts.yml</span>
<span class="hljs-attr">groups:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">api_alerts</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighErrorRate</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">rate(http_requests_total{status=~"5.."}[5m])</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">0.05</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"High error rate detected"</span>
        
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighResponseTime</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">histogram_quantile(0.95,</span> <span class="hljs-string">http_request_duration_seconds)</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">2</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">5m</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"95th percentile response time &gt; 2s"</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighCPUUsage</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">container_cpu_usage</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">80</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">10m</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"CPU usage above 80%"</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">worker_alerts</span>
    <span class="hljs-attr">rules:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">HighQueueDepth</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">celery_queue_length</span> <span class="hljs-string">&gt;</span> <span class="hljs-number">100</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">15m</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"Queue depth above 100 tasks"</span>
      
      <span class="hljs-bullet">-</span> <span class="hljs-attr">alert:</span> <span class="hljs-string">WorkerDown</span>
        <span class="hljs-attr">expr:</span> <span class="hljs-string">up{job="celery-worker"}</span> <span class="hljs-string">==</span> <span class="hljs-number">0</span>
        <span class="hljs-attr">for:</span> <span class="hljs-string">2m</span>
        <span class="hljs-attr">annotations:</span>
          <span class="hljs-attr">summary:</span> <span class="hljs-string">"Celery worker is down"</span>
</div></code></pre>
<hr>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<h3 id="backup-strategy">Backup Strategy</h3>
<h4 id="database-backups">Database Backups</h4>
<ul>
<li><strong>Frequency</strong>: Every 6 hours (Supabase automated)</li>
<li><strong>Retention</strong>: 30 days</li>
<li><strong>Type</strong>: Full backup + point-in-time recovery</li>
<li><strong>Location</strong>: Multi-region storage</li>
</ul>
<h4 id="storage-backups">Storage Backups</h4>
<ul>
<li><strong>Frequency</strong>: Daily incremental</li>
<li><strong>Retention</strong>: 90 days</li>
<li><strong>Type</strong>: Object versioning enabled</li>
<li><strong>Location</strong>: Supabase replication</li>
</ul>
<h4 id="configuration-backups">Configuration Backups</h4>
<ul>
<li><strong>Frequency</strong>: On every change</li>
<li><strong>Retention</strong>: Indefinite (Git)</li>
<li><strong>Type</strong>: Git repository</li>
<li><strong>Location</strong>: GitHub</li>
</ul>
<h3 id="recovery-procedures">Recovery Procedures</h3>
<h4 id="database-recovery">Database Recovery</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Restore from specific point in time</span>
supabase db restore --project-id=xxxxx --timestamp=<span class="hljs-string">"2025-11-06T18:00:00Z"</span>

<span class="hljs-comment"># Verify restoration</span>
psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT COUNT(*) FROM users;"</span>
</div></code></pre>
<h4 id="application-recovery">Application Recovery</h4>
<pre class="hljs"><code><div><span class="hljs-comment"># Rollback to previous version</span>
docker-compose down
git checkout &lt;previous-commit&gt;
docker-compose pull
docker-compose up -d

<span class="hljs-comment"># Or rollback using specific image tag</span>
docker-compose down
sed -i <span class="hljs-string">'s/latest/&lt;previous-tag&gt;/g'</span> docker-compose.yml
docker-compose up -d
</div></code></pre>
<h3 id="recovery-time-objectives">Recovery Time Objectives</h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>RTO</th>
<th>RPO</th>
<th>Strategy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>1 hour</td>
<td>15 minutes</td>
<td>Automated backup restore</td>
</tr>
<tr>
<td>Application</td>
<td>15 minutes</td>
<td>0 (stateless)</td>
<td>Redeploy from images</td>
</tr>
<tr>
<td>Object Storage</td>
<td>4 hours</td>
<td>24 hours</td>
<td>Copy from backup bucket</td>
</tr>
<tr>
<td>Configuration</td>
<td>5 minutes</td>
<td>0</td>
<td>Git checkout</td>
</tr>
</tbody>
</table>
<hr>
<h2 id="security-configuration">Security Configuration</h2>
<h3 id="ssltls-configuration">SSL/TLS Configuration</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Traefik TLS configuration</span>
[entryPoints]
  [entryPoints.websecure]
    <span class="hljs-attribute">address</span> = <span class="hljs-string">":443"</span>
    [entryPoints.websecure.http.tls]
      minVersion = <span class="hljs-string">"VersionTLS12"</span>
      cipherSuites = [
        <span class="hljs-string">"TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384"</span>,
        <span class="hljs-string">"TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256"</span>
      ]
</div></code></pre>
<h3 id="firewall-rules">Firewall Rules</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># UFW configuration</span>
ufw default deny incoming
ufw default allow outgoing
ufw allow 22/tcp    <span class="hljs-comment"># SSH</span>
ufw allow 80/tcp    <span class="hljs-comment"># HTTP</span>
ufw allow 443/tcp   <span class="hljs-comment"># HTTPS</span>
ufw <span class="hljs-built_in">enable</span>
</div></code></pre>
<h3 id="secrets-management">Secrets Management</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Using Docker secrets</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"database_password"</span> | docker secret create db_password -
<span class="hljs-built_in">echo</span> <span class="hljs-string">"api_key"</span> | docker secret create openrouter_key -

<span class="hljs-comment"># Reference in compose file</span>
services:
  api:
    secrets:
      - db_password
      - openrouter_key
</div></code></pre>
<hr>
<h2 id="cost-optimization">Cost Optimization</h2>
<h3 id="infrastructure-costs-monthly">Infrastructure Costs (Monthly)</h3>
<table>
<thead>
<tr>
<th>Service</th>
<th>Configuration</th>
<th>Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>DigitalOcean Droplet</td>
<td>8GB RAM, 4 CPUs</td>
<td>$48</td>
</tr>
<tr>
<td>Redis Cloud</td>
<td>4GB</td>
<td>$45</td>
</tr>
<tr>
<td>Supabase Pro</td>
<td>Database + Storage</td>
<td>$25</td>
</tr>
<tr>
<td>Netlify Pro</td>
<td>CDN + Hosting</td>
<td>$19</td>
</tr>
<tr>
<td>Cloudflare Pro</td>
<td>DNS + Security</td>
<td>$20</td>
</tr>
<tr>
<td><strong>Total Infrastructure</strong></td>
<td></td>
<td><strong>$157</strong></td>
</tr>
</tbody>
</table>
<h3 id="ai-service-costs-variable">AI Service Costs (Variable)</h3>
<table>
<thead>
<tr>
<th>Service</th>
<th>Usage</th>
<th>Monthly Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenRouter</td>
<td>50M tokens</td>
<td>$250-500</td>
</tr>
<tr>
<td>ModelsLab</td>
<td>5,000 images</td>
<td>$50-150</td>
</tr>
<tr>
<td>ElevenLabs</td>
<td>500K characters</td>
<td>$90</td>
</tr>
<tr>
<td><strong>Total AI</strong></td>
<td></td>
<td><strong>$390-740</strong></td>
</tr>
</tbody>
</table>
<h3 id="cost-optimization-strategies">Cost Optimization Strategies</h3>
<ol>
<li><strong>Caching</strong>: Reduce AI API calls by 30-40%</li>
<li><strong>Batch Processing</strong>: Group similar requests</li>
<li><strong>Tier-based Models</strong>: Use cheaper models for free tier</li>
<li><strong>Spot Instances</strong>: Use for non-critical workers</li>
<li><strong>Auto-scaling</strong>: Scale down during off-hours</li>
</ol>
<hr>
<h2 id="quick-reference">Quick Reference</h2>
<h3 id="deployment-commands">Deployment Commands</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Deploy to production</span>
git push origin main  <span class="hljs-comment"># Triggers CI/CD</span>

<span class="hljs-comment"># Manual deployment</span>
ssh production-server
<span class="hljs-built_in">cd</span> /opt/litinkai
git pull
docker-compose up -d --build

<span class="hljs-comment"># View logs</span>
docker-compose logs -f api
docker-compose logs -f worker-image

<span class="hljs-comment"># Scale services</span>
docker-compose up --scale api=5 -d
docker-compose up --scale worker-video=4 -d

<span class="hljs-comment"># Health check</span>
curl https://api.litinkai.com/health
</div></code></pre>
<h3 id="troubleshooting">Troubleshooting</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Check service status</span>
docker-compose ps

<span class="hljs-comment"># Restart specific service</span>
docker-compose restart api

<span class="hljs-comment"># Clear Redis cache</span>
docker-compose <span class="hljs-built_in">exec</span> redis redis-cli FLUSHALL

<span class="hljs-comment"># View worker tasks</span>
docker-compose <span class="hljs-built_in">exec</span> flower celery -A app.celery_app inspect active

<span class="hljs-comment"># Database connection test</span>
docker-compose <span class="hljs-built_in">exec</span> api python -c <span class="hljs-string">"from app.database import test_connection; test_connection()"</span>
</div></code></pre>
<hr>
<h2 id="references">References</h2>
<ul>
<li><a href="https://docs.docker.com/">Docker Documentation</a></li>
<li><a href="https://doc.traefik.io/traefik/">Traefik Documentation</a></li>
<li><a href="https://docs.celeryq.dev/en/stable/userguide/index.html">Celery Best Practices</a></li>
<li><a href="README.md">Main Architecture README</a></li>
</ul>
<hr>
<p><strong>Last Updated</strong>: 2025-11-06<br>
<strong>Version</strong>: 1.0<br>
<strong>Maintained By</strong>: DevOps Team</p>

</body>
</html>
